# 주 메모리의 관리(1)

## 목차
- 프로세스와 주 메모리의 관계
- 메모리 공간
- 메모리 할당 과정
- 연속 메모리 할당

---

## 프로세스와 주 메모리의 관계 
프로세스는 실행중인 프로그램이다. 이 프로세스는 별개의 메모리 공간을 가져야 한다.

## 메모리 공간
각각의 프로세스는 별개의 메모리 공간을 갖는 것을 보장해야 한다. 메모리 공간에는 프로세스들의 시작주소와 종료주소를 정의하기 위해 베이스 레지스터와 한계 레지스터를 제공한다.
- 베이스 레지스터(base register): 메모리에 프로그램이 할당 될 때 프로그램의 시작 register 주소
- 한계 레지스터(limit register): 메모리에 프로그램이 할당 될 때 프로그램의 마지막 register 주소

프로세스를 보호하기 위해 가상 주소가 limit을 넘어간 경우 운영체제는 예외를 발생시킨다. 두 값은 각 프로그램의 고유값으로 PCB에 저장된다.

<details>
  <summary>
      PCB 블록이란?
  </summary>
    프로세스 제어 블록은 프로세스의 정보를 표현한 
  운영 체제 커널의 자료 구조이다. 작업 제어 블록(TCB)라고도 한다.
    
  포함 정보
  - 프로세스 식별자(Process ID)
  - 프로세스 상태: 생성, 준비, 실행, 대기, 완료 상태
  - 프로그램 계수기(Process Counter): 이 프로세스 다음에 실행할 명령어의 주소
</details>	

## 메모리 할당 과정
주소에는 논리적 메모리 주소와 물리적 메모리 주소가 존재한다.
- 논리적 메모리 주소
  - CPU에 의해 생성된 주소
  - 일반적인 사용자가 사용하는 주소
  - 실제 프로그램을 실행시킬 때 논리적 메모리 주소와 물리적 메모리 주소를 대응시켜 사용자가 메모리 관리를 편하게 함
- 물리적 메모리 주소
  - 메모리 장치에 의해 인식되는 주소
  - 논리적 메모리 주소에서 실제 물리적인 메모리에 접근하기 위해 사용되는 주소

![image](https://github.com/STUDY-0x0E/CS-STUDY/assets/123740296/74e6c2fb-a1a6-419b-a1fd-b9aea48d40f6)

여기서 MMU는 논리적 주소를 물리적 주소로 바꿔주는 하드웨어 기기이다.




## 연속 메모리 할당
프로세스가 필요로 하는 데이터를 메모리에 연속적으로 할당한다.

### 고정 할당 방법(Fixed Allocation)
여러 프로세스가 사용할 수 있는 공간을 고정된 크기로 나눈다.

내부 단편화 현상이 발생한다.

**내부 단편화**

주기억장치 내 사용자 영역이 실행 프로그램보다 커서 프로그램의 사용 공간을 할당 한 후 사용되지 않고 남게 되는 현상

<img width="372" alt="스크린샷 2023-12-05 오후 9 25 24" src="https://github.com/STUDY-0x0E/CS-STUDY/assets/123740296/b43c358e-d5a3-4a71-9157-800074d5f35c">

비어있는 사용자 공간은 100mb이고 프로세스 C 크기는 50mb로 50mb가 낭비됨

### 가변 할당 방법(Variable Allocation)
프로세스가 사용할 공간을 프로세스의 크기에 맞춰 나눈다. 프로세스가 시작할때, 종료할때 Allocation Table을 변경하면서 파티션을 관리한다.

할당하는 방법:
- First-Fit: 비어있는 공간 중 들어갈 수 있는 가장 첫번째 공간에 할당
- Best-Fit: 비어있는 공간 중 들어갈 수 있는 차이가 가장 작은 공간에 할당
- Worst-Fit: 비어있는 공간 중 들어갈 수 있는 차이가 가장 큰 공간에 할당
<img width="414" alt="스크린샷 2023-12-05 오후 9 09 47" src="https://github.com/STUDY-0x0E/CS-STUDY/assets/123740296/a8d29784-ec66-4a20-bb04-d5d3938855c3">

외부 단편화가 현상이 발생한다.

**외부 단편화**

남아있는 총 메모리 공간이 요청한 메모리 공간보다 크지만 남아있는 공간이 연속적이지 않아 발생

<img width="368" alt="스크린샷 2023-12-05 오후 9 24 04" src="https://github.com/STUDY-0x0E/CS-STUDY/assets/123740296/178e06e0-b4d2-4882-aea8-7349d8c76e4a">

총 남아있는 메모리 공간은 100mb이지만 프로세스의 C 크기는 80mb로 할당할 수 없어 메모리 공간이 낭비됨

---
참조
- [https://ko.m.wikipedia.org/wiki/%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4_%EC%A0%9C%EC%96%B4_%EB%B8%94%EB%A1%9D](https://ko.m.wikipedia.org/wiki/%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4_%EC%A0%9C%EC%96%B4_%EB%B8%94%EB%A1%9D)
- [https://blog.mglee.dev/blog/%EC%97%B0%EC%86%8D%EB%A9%94%EB%AA%A8%EB%A6%AC-%ED%95%A0%EB%8B%B9%EA%B3%BC-%EC%A3%BC%EC%86%8C-%EA%B3%B5%EA%B0%84/](https://blog.mglee.dev/blog/%EC%97%B0%EC%86%8D%EB%A9%94%EB%AA%A8%EB%A6%AC-%ED%95%A0%EB%8B%B9%EA%B3%BC-%EC%A3%BC%EC%86%8C-%EA%B3%B5%EA%B0%84/)
- [https://yonghwankim-dev.tistory.com/484](https://yonghwankim-dev.tistory.com/484)
