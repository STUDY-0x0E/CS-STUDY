## 4.2 ERD와 정규화 과정

### 4.2.1 ERD의 중요성
**E**ntity **R**elationship **D**iagram은 릴레이션 간의 관계들을 정의한 것이며 시스템의 요구사항을 기반으로 작성된다.

ERD를 기반으로 데이터베이스를 구축하며 이후에 디버깅 또는 비즈니스 프로세스 재설계가 필요한 경우에도 설계도 역할을 담당한다.

하지만 ERD는 비정형 데이터를 충분히 표현할 수 없다는 단점이 있다.

### 4.2.2 ERD 기호
<p align="center"><img src="https://github.com/STUDY-0x0E/CS-STUDY/assets/39394642/e5213378-cb0f-4793-af87-9fe6f25281de" style="width:70%"></p>


### 4.2.3 정규화 과정<sup>Normalization</sup>

**정규형 원칙**

① 자료의 중복성은 감소해야 하고, ② 독립적인 관계는 별개의 릴레이션으로 표현해야 하며, ③ 각각의 릴레이션은 독립적인 표현이 가능해야 한다.

**제1정규형**

릴레이션의 모든 도메인이 더 이상 분해될 수 없는 원자 값<sup>atomic value</sup>만으로 구성되어 있어야 한다.

한 개의 기본 키에 대해 두 개 이상의 값을 가지는 반복 집합이 있어서는 안된다.

**제2정규형**

릴레이션이 제1정규형이며 부분 함수의 종속성을 제거한 형태

부분 함수의 종속성 제거: 기본키가 아닌 모든 속성이 기본키에 완전 함수 종속적인 것

:exclamation:  릴레이션을 분해할 때 동등한 릴레이션으로 분해해야 하고, 정보 손실이 방색하지 않는 무손실 분해로 분해되어야 함

[예제]
<p align="center"><img src="https://github.com/STUDY-0x0E/CS-STUDY/assets/39394642/5920f5bf-4360-4836-965d-155cc3a39217"></p>

위 테이블에서 기본키는 (학생 번호, 과목)으로 복합키이다. (성적을 알기 위해서는 학생 번호+과목을 알아야 한다. -> 102번의 자바 성적 70)

그런데 지도교수 칼럼은 (학생 번호, 과목)에 종속되지 않고 (과목)에만 종속되는 부분적 종속이다. (자바의 지도교수 박자바)

따라서 제2정규형을 만족하지 않으므로 아래와 같이 분해해야 한다.
<p align="center"><img src="https://github.com/STUDY-0x0E/CS-STUDY/assets/39394642/8dce8380-a357-45b5-8f79-973bfef79a0f"></p>


**제3정규형**

릴레이션이 제2정규형이며 모든 속성이 이행적 함수 종속<sup>transitive FD</sup>을 만족하지 않는 상태

이행적 함수 종속: A -> B와 B -> C가 존재하면 A -> C가 성립하는데, 이 때 C가 A에 이행적으로 함수 종속되었다고 한다.

[예제]
<p align="center"><img src="https://github.com/STUDY-0x0E/CS-STUDY/assets/39394642/c183f71a-3cd3-45d4-9bd3-dd763dd77322"></p>

ID를 알면 등급을 알 수 있다. 등급을 알면 할인율을 알 수 있다. 따라서 ID를 알면 할인율을 알 수 있다.

따라서 할인율이 ID에 이행적으로 함수 종속 되었으므로 아래와 같이 분해해야 한다.
<p align="center"><img src="https://github.com/STUDY-0x0E/CS-STUDY/assets/39394642/8459f21d-fd9b-4ed7-b817-9511ca835f8d"></p>


**보이스/코드 정규형**

릴레이션이 제3정규형이며 결정자가 후보키가 아닌 함수 종속 관계를 제거하여 릴레이션의 함수 종속 관계에서 모든 결정자가 후보키인 상태

결정자: 함수 종속 관계에서 X -> Y일 때 X는 결정자, Y는 종속자이다.

후보키: 각 행을 유일하게 식별할 수 있는 최소한의 속성들의 집합

[예제]
<p align="center"><img src="https://github.com/STUDY-0x0E/CS-STUDY/assets/39394642/cb2836ae-20f9-4d80-ab69-4bfd6ab2f683"></p>

위 테이블의 기본키는 (학생 번호, 과목)이지만, 지도교수가 어떤 과목을 가르치는지 알 수 있으므로 지도교수 -> 과목 종속이 성립한다.

이처럼 후보키 집합이 아닌 칼럼이 결정자가 되어버린 상황을 BCNF를 만족하지 않는다고 한다. 

BCNF를 만족하기 위해서는 아래와 같이 분해하면 된다.

<p align="center"><img src="https://github.com/STUDY-0x0E/CS-STUDY/assets/39394642/24fb588d-b9e4-4430-9833-ae0df206ff2d"></p>

**정리**
| 단계 | 과정 |
| --- | --- |
| 1정규형(1NF) | 원자값으로 구성 |
| 2정규형(2NF) | 부분 함수 종속 제거(완전 함수적 종속 관계) |
| 3정규형(3NF) | 이행함수 종속 제거 |
| 보이스-코드 정규형(BCNF) | 결정자 후보 키가 아닌 함수 종속 제거 |
| 4정규형(4NF) | 다치(다중 값) 종속 제거 |
| 5정규형(5NF) | 조인 종속 제거 |

### 4.2.4 정규화의 장점

1. 데이터베이스 변경 시 이상 현상(Anomaly) 제거

2. 데이터베이스 구조 확장 시 재 디자인 최소화
   
3. 테이블 간의 관계와 개념을 더욱 의미있게 반영

<br><hr>
:exclamation:  정규형 과정을 거친다고 성능이 100% 좋아지는 것은 아니다. 서비스에 따라 정규화 또는 비정규화 과정을 진행해야 한다.

**비정규화**<sup>Denormalization</sup>: 정규화된 엔터티, 속성, 관계에 대해 성능 향상과 개발 운영의 단순화를 위해 중복, 통합, 분리 등을 수행하는 데이터 모델링 기법

디스크 I/O 량이 많아서 조회 시 성능이 저하되거나, 테이블끼리의 경로가 너무 멀어 조인으로 인한 성능 저하가 예상되거나, 칼럼을 계산하여 조회할 때 성능이 저하될 것이 예상되는 경우 (조회에 대한 처리 성능이 중요하다고 판단될 때) 비정규화를 고려하게 된다.
