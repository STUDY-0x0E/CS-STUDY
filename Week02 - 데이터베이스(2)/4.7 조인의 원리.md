

책에서는 중첩 루프 조인에 대해서만 수도코드를 제공하는데, 각각 조인에 대해서 수도코드를 작성해보았습니다.



# 세가지 조인 원리 - 중첩, 정렬, 해시


1. **중첩 루프 조인 (Nested Loop Join):**
   - 가장 간단한 형태의 조인 알고리즘입니다.
   - 하나의 테이블을 기준으로 각 행을 가져오고, 다른 테이블의 모든 행들과 비교합니다.
   - 시간 복잡도는 O(n*m)이며, n과 m은 각각 두 테이블의 행의 수입니다.
   
   **수도코드 예시:**
   ```python
   for each row in table1:
       for each row in table2:
           if rows match:
               output combined row
   ```

2. **정렬 병합 조인 (Merge Sort Join):**
   - 두 개의 테이블을 정렬한 후, 정렬된 상태에서 병합하는 방식입니다.
   - 두 테이블이 이미 정렬되어 있어야 하므로, 정렬 비용이 들어갈 수 있습니다.
   - 시간 복잡도는 O(n*log(n) + m*log(m) + n + m)입니다.

   **수도코드 예시:**
   ```python
   sort table1 by join key
   sort table2 by join key
   merge table1 and table2 by join key
   ```

3. **해시 조인 (Hash Join):**
   - 두 테이블을 해시 함수를 사용하여 해시 테이블로 만들어 조인하는 방식입니다.
   - 해시 함수를 사용하기 때문에 빠르게 조인을 수행할 수 있지만, 메모리를 많이 사용할 수 있습니다.
   - 시간 복잡도는 일반적으로 O(n + m)입니다.
   - 인 메모리(RAM) 기반으로 처리되는데, 만약 A테이블과 B테이블을 조인하는 경우, 데이터가 더 작은 테이블을 메모리로 올립니다.
   - 만약 테이블 크기가 너무 커서 RAM에 올릴 수 없는 경우에는, 디스크 기반 해시 조인을 사용할 수 있습니다. 이 경우 디스크 I/O의 오버헤드로 인해 성능이 저하될 수 있습니다.

   **수도코드 예시:**
   ```python
    # 빌드단계: table1과 table2의 크기를 비교하여 더 작은 테이블을 메모리에 빌드한다.
    if size(table1) < size(table2):
        create hash table from table1  # table1이 더 작을 경우 table1을 해시 테이블로 만듭니다.
    else:
        create hash table from table2  # table2가 더 작을 경우 table2를 해시 테이블로 만듭니다.
    
    # 프로브 단계: 큰 테이블을 스캔하면서 해시 값을 계산하고, 해시 테이블에서 매칭된 값을 찾는다.
    for each row in larger_table:
        hash_value = hash(row)  # 현재 행의 해시 값을 계산한다.
        
        if hash_value matches a value in hash table:
            output combined row  # 매칭된 값을 찾으면 조인된 결과를 출력한다.
   ```



# 어떤 상황에 어떤 조인이 유리할까

1. **중첩 루프 조인 (Nested Loop Join):**
   - 작은 테이블과 큰 테이블 간의 조인을 수행할 때 작은 테이블의 크기가 상대적으로 작을 때 유리합니다.
   - 예시: 주문 테이블과 상품 테이블을 조인할 때, 한 주문당 상품 수가 평균적으로 적을 경우.

2. **정렬 병합 조인 (Merge Sort Join):**
   - 조인 조건으로 정렬된 입력이 필요할 때 유리합니다.
   - 예시: 두 테이블이 이미 정렬되어 있을 경우 또는 조인 조건이 정렬된 상태로 제공될 때.

3. **해시 조인 (Hash Join):**
   - 큰 테이블과 작은 테이블 간의 조인을 수행할 때 작은 테이블의 크기가 상대적으로 작을 때 유리합니다.
   - 예시: 매출 테이블과 고객 테이블을 조인할 때, 고객 수가 상대적으로 적을 경우.

4. **기타 알고리즘 (예: 인덱스 조인):**
   - 인덱스가 적절히 활용될 수 있는 경우 유리합니다.
   - 예시: 조인 조건에 사용될 열이 적절하게 인덱싱되어 있는 경우.
